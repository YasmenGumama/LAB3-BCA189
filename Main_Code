#include <Wire.h>
#include <RTClib.h>
#include <LiquidCrystal_I2C.h>

// Initialize the RTC and LCD objects
RTC_DS3231 rtc;

// Change 0x27 to your LCD's address if the scanner showed something different (e.g., 0x3F)
// Parameters: address, columns, rows (assumes a 16x2 LCD)
LiquidCrystal_I2C lcd(0x27, 16, 2); 

void setup() {
  Serial.begin(115200);
  Wire.begin(); // Join I2C bus

  // Initialize LCD
  lcd.init();
  lcd.backlight();
  lcd.setCursor(0, 0);
  lcd.print("System Booting...");

  // Initialize RTC
  if (!rtc.begin()) {
    Serial.println("Couldn't find RTC");
    lcd.clear();
    lcd.print("RTC Error!");
    while (1) delay(10); // Halt execution
  }

  // If the RTC lost power, set it to the time the sketch was compiled
  if (rtc.lostPower()) {
    Serial.println("RTC lost power, setting time...");
    rtc.adjust(DateTime(F(__DATE__), F(__TIME__)));
  }
  
  delay(2000);
  lcd.clear();
}

void loop() {
  DateTime now = rtc.now();
  float currentTemp = rtc.getTemperature();

  // --- 1. Print Data to Serial Monitor ---
  Serial.print("Date: ");
  Serial.print(now.year(), DEC);
  Serial.print('/');
  Serial.print(now.month(), DEC);
  Serial.print('/');
  Serial.print(now.day(), DEC);
  
  Serial.print(" | Time: ");
  Serial.print(now.hour(), DEC);
  Serial.print(':');
  Serial.print(now.minute(), DEC);
  Serial.print(':');
  Serial.print(now.second(), DEC);
  
  Serial.print(" | Temp: ");
  Serial.print(currentTemp);
  Serial.println(" C");

  // --- 2. Print Data to LCD Display ---
  // Row 0: Time
  lcd.setCursor(0, 0);
  lcd.print("Time: ");
  if(now.hour() < 10) lcd.print('0');
  lcd.print(now.hour(), DEC);
  lcd.print(':');
  if(now.minute() < 10) lcd.print('0');
  lcd.print(now.minute(), DEC);
  lcd.print(':');
  if(now.second() < 10) lcd.print('0');
  lcd.print(now.second(), DEC);

  // Row 1: Temperature
  lcd.setCursor(0, 1);
  lcd.print("Temp: ");
  lcd.print(currentTemp);
  lcd.print(" C  "); // Extra spaces to clear trailing characters

  delay(1000); // Wait 1 second before updating again
}
